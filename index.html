<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">


    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
    <div class="container py-4">
        <h2 class="mb-4 text-center">–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞ <i class="fa-solid fa-user-secret"></i></h2>

        <!-- –ë–ª–æ–∫ –æ—à–∏–±–æ–∫ -->
        <div id="errorBox" class="alert alert-danger d-none"></div>

        <!-- –®–∞–≥ 1: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ -->
        <div id="setupSection">
            <div class="mb-3">
                <label for="participantCount" class="form-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ <i class="fa-solid fa-people-pulling"></i></label>
                <input type="number" min="2" class="form-control" id="participantCount" value="3">
            </div>

            <button id="createFieldsBtn" class="btn btn-secondary mb-3">
                <i class="fa-solid fa-plus"></i> –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—è –¥–ª—è –∏–º—ë–Ω
      </button>

            <div id="namesContainer" class="mt-3"></div>

            <button id="generateBtn" class="btn btn-info mt-3 d-none">
                <i class="fa-solid fa-shuffle"></i> –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∂–µ—Ä–µ–±—å—ë–≤–∫—É
      </button>
        </div>

        <!-- –®–∞–≥ 2: –ø–æ–∫–∞–∑ –ø–æ –æ–¥–Ω–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É -->
        <div id="drawSection" class="d-none mt-4">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-3">–¢–µ–∫—É—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫:</h5>
                    <p id="currentParticipantName" class="fs-5 fw-bold"></p>

                    <div id="beforeShowRecipient">
                        <p class="text-muted mb-3">
                            –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç–∫—Ä–∞–Ω —ç—Ç–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É.
                        </p>
                        <button id="showRecipientBtn" class="btn btn-info">
                            <i class="fa-solid fa-eye"></i> –ü–æ–∫–∞–∑–∞—Ç—å, –∫–æ–º—É —è –¥–∞—Ä—é –ø–æ–¥–∞—Ä–æ–∫
            </button>
                    </div>

                    <div id="afterShowRecipient" class="d-none">
                        <p class="mt-3 mb-2">–í—ã –¥–∞—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–æ–∫:</p>
                        <p id="currentRecipientName" class="fs-4 fw-bold">
                            üéÅ
                        </p>

                        <button id="nextParticipantBtn" class="btn btn-secondary me-2">
                            <i class="fa-solid fa-eye-slash"></i> –°–∫—Ä—ã—Ç—å –∏ —Å–ª–µ–¥—É—é—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫ <i class="fa-solid fa-angle-right"></i>
            </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –®–∞–≥ 3: –∑–∞–≤–µ—Ä—à–µ–Ω–æ -->
        <div id="doneSection" class="d-none mt-4">
            <div class="alert alert-info">
                <i class="fa-solid fa-gifts"></i> –ñ–µ—Ä–µ–±—å—ë–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —É–∑–Ω–∞–ª–∏, –∫–æ–º—É –¥–∞—Ä—è—Ç –ø–æ–¥–∞—Ä–∫–∏.
            </div>
            <button id="restartBtn" class="btn btn-outline-primary">
        –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ
      </button>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞
        let names = []; // —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω
        let assignments = []; // –∏–Ω–¥–µ–∫—Å ‚Üí –∏–Ω–¥–µ–∫—Å –ø–æ–ª—É—á–∞—Ç–µ–ª—è
        let currentIndex = 0; // –∫–∞–∫–æ–π —É—á–∞—Å—Ç–Ω–∏–∫ —Å–µ–π—á–∞—Å

        // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
        function showError(message) {
            $('#errorBox').text(message).removeClass('d-none');
        }

        // –°–∫—Ä—ã—Ç—å –æ—à–∏–±–∫—É
        function clearError() {
            $('#errorBox').addClass('d-none').text('');
        }

        // –§–∏—à–µ—Ä‚Äì–ô–µ—Ç—Å –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–µ–π –¥–ª—è –∏–º—ë–Ω
        $('#createFieldsBtn').on('click', function() {
            clearError();
            const n = parseInt($('#participantCount').val(), 10);

            if (!n || n < 2) {
                showError('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞.');
                $('#namesContainer').empty();
                $('#generateBtn').addClass('d-none');
                return;
            }

            const $container = $('#namesContainer');
            $container.empty();

            for (let i = 0; i < n; i++) {
                const fieldHtml = `
          <div class="mb-2">
            <label class="form-label">–£—á–∞—Å—Ç–Ω–∏–∫ ${i + 1}</label>
            <input type="text" class="form-control name-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
          </div>
        `;
                $container.append(fieldHtml);
            }

            $('#generateBtn').removeClass('d-none');
        });

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∂–µ—Ä–µ–±—å—ë–≤–∫–∏
        $('#generateBtn').on('click', function() {
            clearError();

            const $inputs = $('.name-input');
            const n = $inputs.length;

            if (n < 2) {
                showError('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞.');
                return;
            }

            names = [];
            $inputs.each(function() {
                names.push($(this).val().trim());
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –≤—Å–µ –∏–º–µ–Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
            if (names.some(name => !name)) {
                showError('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.');
                return;
            }

            // –ò–Ω–¥–µ–∫—Å—ã 0..n-1
            let indices = Array.from({
                length: n
            }, (_, i) => i);
            let shuffled;

            // –î–µ—Ä—Ä–∞–Ω–∂–º–µ–Ω—Ç: –Ω–∏–∫—Ç–æ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å–∞–º–æ–≥–æ —Å–µ–±—è
            do {
                shuffled = shuffle(indices.slice());
            } while (shuffled.some((v, i) => v === i) && n > 1);

            assignments = shuffled;
            currentIndex = 0;

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ —Ä–µ–∂–∏–º "–ø–æ –æ–¥–Ω–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É"
            $('#setupSection').addClass('d-none');
            $('#doneSection').addClass('d-none');

            $('#drawSection').removeClass('d-none');
            $('#beforeShowRecipient').removeClass('d-none');
            $('#afterShowRecipient').addClass('d-none');

            $('#currentParticipantName').text(names[currentIndex]);
            $('#currentRecipientName').text('');
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å, –∫–æ–º—É –¥–∞—Ä–∏—Ç —Ç–µ–∫—É—â–∏–π
        $('#showRecipientBtn').on('click', function() {
            const recipientIndex = assignments[currentIndex];
            const recipientName = names[recipientIndex];

            $('#currentRecipientName').text('üéÅ ' + recipientName);
            $('#beforeShowRecipient').addClass('d-none');
            $('#afterShowRecipient').removeClass('d-none');
        });

        // –°–ª–µ–¥—É—é—â–∏–π —É—á–∞—Å—Ç–Ω–∏–∫
        $('#nextParticipantBtn').on('click', function() {
            currentIndex++;

            if (currentIndex >= names.length) {
                // –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø—Ä–æ—à–ª–∏
                $('#drawSection').addClass('d-none');
                $('#doneSection').removeClass('d-none');
                return;
            }

            // –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
            $('#currentParticipantName').text(names[currentIndex]);
            $('#currentRecipientName').text('');
            $('#beforeShowRecipient').removeClass('d-none');
            $('#afterShowRecipient').addClass('d-none');
        });

        // –ù–∞—á–∞—Ç—å –≤—Å—ë –∑–∞–Ω–æ–≤–æ
        $('#restartBtn').on('click', function() {
            names = [];
            assignments = [];
            currentIndex = 0;

            $('#participantCount').val(3);
            $('#namesContainer').empty();
            $('#generateBtn').addClass('d-none');

            clearError();

            $('#doneSection').addClass('d-none');
            $('#drawSection').addClass('d-none');
            $('#setupSection').removeClass('d-none');
        });
    </script>
</body>
<style>
    body {
        background: black;
        color: white;
    }
</style>

</html>